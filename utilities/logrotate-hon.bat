@echo off

:: BatchGotAdmin
:-------------------------------------
REM  --> Check for permissions
>nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"

REM --> If error flag set, we do not have admin.
if '%errorlevel%' NEQ '0' (
    echo Requesting administrative privileges...
    goto UACPrompt
) else ( goto gotAdmin )

:UACPrompt
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"
    set params = %*:"=""
    echo UAC.ShellExecute "cmd.exe", "/c %~s0 %params%", "", "runas", 1 >> "%temp%\getadmin.vbs"

    "%temp%\getadmin.vbs"
    del "%temp%\getadmin.vbs"
    exit /B

:gotAdmin
    pushd "%CD%"
    CD /D "%~dp0"
:--------------------------------------
echo I2F0IHRvcCBvZiBzY3JpcHQNCmlmICghDQogICAgI2N1cnJlbnQgcm9sZQ0KICAgIChOZXctT2JqZWN0IFNlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzUHJpbmNpcGFsKA0KICAgICAgICBbU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eV06OkdldEN1cnJlbnQoKQ0KICAgICNpcyBhZG1pbj8NCiAgICApKS5Jc0luUm9sZSgNCiAgICAgICAgW1NlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzQnVpbHRJblJvbGVdOjpBZG1pbmlzdHJhdG9yDQogICAgKQ0KKSB7DQogICAgI2VsZXZhdGUgc2NyaXB0IGFuZCBleGl0IGN1cnJlbnQgbm9uLWVsZXZhdGVkIHJ1bnRpbWUNCiAgICBTdGFydC1Qcm9jZXNzIGANCiAgICAgICAgLUZpbGVQYXRoICdwb3dlcnNoZWxsJyBgDQogICAgICAgIC1Bcmd1bWVudExpc3QgKA0KICAgICAgICAgICAgI2ZsYXR0ZW4gdG8gc2luZ2xlIGFycmF5DQogICAgICAgICAgICAnLUZpbGUnLCAkTXlJbnZvY2F0aW9uLk15Q29tbWFuZC5Tb3VyY2UsICRhcmdzIGANCiAgICAgICAgICAgIHwgJXsgJF8gfQ0KICAgICAgICApIGANCiAgICAgICAgLVZlcmIgUnVuQXMNCiAgICBleGl0DQp9DQpXcml0ZS1Ib3N0KCJDdXJyZW50IERpcmVjdG9yeTogJFBTU2NyaXB0Um9vdCIpDQpjZCAkUFNTY3JpcHRSb290DQokbGltaXQgPSAoR2V0LURhdGUpLkFkZERheXMoLTE1KQ0KZnVuY3Rpb24gUmVtb3ZlLUxvZ3MNCnsNCiAgICAkbG9ncyA9ICIkX1xEb2N1bWVudHNcSGVyb2VzIG9mIE5ld2VydGggeDY0XGdhbWVcbG9nc1wiDQogICAgJHJlcGxheXMgPSAiJF9cRG9jdW1lbnRzXEhlcm9lcyBvZiBOZXdlcnRoIHg2NFxnYW1lXHJlcGxheXNcIg0KICAgIHdyaXRlLWhvc3QgKCJjbGVhbmluZyBsb2dzLi4uICRsb2dzIikNCiAgICB3cml0ZS1ob3N0ICgiY2xlYW5pbmcgcmVwbGF5cy4uLiAkcmVwbGF5cyIpDQogICAgR2V0LUNoaWxkSXRlbSAtUGF0aCAkbG9ncyAtRm9yY2UgfCBXaGVyZS1PYmplY3QgeyAhJF8uUFNJc0NvbnRhaW5lciAtYW5kICRfLkxhc3RXcml0ZVRpbWUgLWx0ICRsaW1pdH0gfCBSZW1vdmUtSXRlbSAtRm9yY2UNCiAgICBHZXQtQ2hpbGRJdGVtIC1QYXRoICRyZXBsYXlzIC1Gb3JjZSB8IFdoZXJlLU9iamVjdCB7ICEkXy5QU0lzQ29udGFpbmVyIC1hbmQgJF8uTGFzdFdyaXRlVGltZSAtbHQgJGxpbWl0fSB8ICBSZW1vdmUtSXRlbSAtRm9yY2UNCg0KICAgICMgRGVsZXRlIGFueSBlbXB0eSBkaXJlY3RvcmllcyBsZWZ0IGJlaGluZCBhZnRlciBkZWxldGluZyB0aGUgb2xkIGZpbGVzLg0KICAgIEdldC1DaGlsZEl0ZW0gLVBhdGggJGxvZ3MgLUZvcmNlIHwgV2hlcmUtT2JqZWN0IHsgJF8uUFNJc0NvbnRhaW5lciAtYW5kIChHZXQtQ2hpbGRJdGVtIC1QYXRoICRfLkZ1bGxOYW1lIC1SZWN1cnNlIC1Gb3JjZSB8IFdoZXJlLU9iamVjdCB7ICEkXy5QU0lzQ29udGFpbmVyIH0pIC1lcSAkbnVsbH0gfCBSZW1vdmUtSXRlbSAtRm9yY2UgLVJlY3Vyc2UNCiAgICBHZXQtQ2hpbGRJdGVtIC1QYXRoICRyZXBsYXlzIC1Gb3JjZSB8IFdoZXJlLU9iamVjdCB7ICRfLlBTSXNDb250YWluZXIgLWFuZCAoR2V0LUNoaWxkSXRlbSAtUGF0aCAkXy5GdWxsTmFtZSAtUmVjdXJzZSAtRm9yY2UgfCBXaGVyZS1PYmplY3QgeyAhJF8uUFNJc0NvbnRhaW5lciB9KSAtZXEgJG51bGx9IHwgUmVtb3ZlLUl0ZW0gLUZvcmNlIC1SZWN1cnNlDQp9DQoNCmZ1bmN0aW9uIFJlbW92ZS1Mb2dzLVZpZXcgew0KICAgICRsb2dzID0gIiRfXERvY3VtZW50c1xIZXJvZXMgb2YgTmV3ZXJ0aCB4NjRcZ2FtZVxsb2dzXCINCiAgICAkcmVwbGF5cyA9ICIkX1xEb2N1bWVudHNcSGVyb2VzIG9mIE5ld2VydGggeDY0XGdhbWVccmVwbGF5c1wiDQogICAgR2V0LUNoaWxkSXRlbSAtUGF0aCAkbG9ncyAtRm9yY2UgfCBXaGVyZS1PYmplY3QgeyAhJF8uUFNJc0NvbnRhaW5lciAtYW5kICRfLkxhc3RXcml0ZVRpbWUgLWx0ICRsaW1pdH0gfCBSZW1vdmUtSXRlbSAtV2hhdElmIC1Gb3JjZQ0KICAgIEdldC1DaGlsZEl0ZW0gLVBhdGggJHJlcGxheXMgLUZvcmNlIHwgV2hlcmUtT2JqZWN0IHsgISRfLlBTSXNDb250YWluZXIgLWFuZCAkXy5MYXN0V3JpdGVUaW1lIC1sdCAkbGltaXR9IHwgIFJlbW92ZS1JdGVtIC1XaGF0SWYgLUZvcmNlDQoNCiAgICAjIERlbGV0ZSBhbnkgZW1wdHkgZGlyZWN0b3JpZXMgbGVmdCBiZWhpbmQgYWZ0ZXIgZGVsZXRpbmcgdGhlIG9sZCBmaWxlcy4NCiAgICBHZXQtQ2hpbGRJdGVtIC1QYXRoICRsb2dzIC1Gb3JjZSB8IFdoZXJlLU9iamVjdCB7ICRfLlBTSXNDb250YWluZXIgLWFuZCAoR2V0LUNoaWxkSXRlbSAtUGF0aCAkXy5GdWxsTmFtZSAtUmVjdXJzZSAtRm9yY2UgfCBXaGVyZS1PYmplY3QgeyAhJF8uUFNJc0NvbnRhaW5lciB9KSAtZXEgJG51bGx9IHwgUmVtb3ZlLUl0ZW0gLVdoYXRJZiAtRm9yY2UgLVJlY3Vyc2UNCiAgICBHZXQtQ2hpbGRJdGVtIC1QYXRoICRyZXBsYXlzIC1Gb3JjZSB8IFdoZXJlLU9iamVjdCB7ICRfLlBTSXNDb250YWluZXIgLWFuZCAoR2V0LUNoaWxkSXRlbSAtUGF0aCAkXy5GdWxsTmFtZSAtUmVjdXJzZSAtRm9yY2UgfCBXaGVyZS1PYmplY3QgeyAhJF8uUFNJc0NvbnRhaW5lciB9KSAtZXEgJG51bGx9IHwgUmVtb3ZlLUl0ZW0gLVdoYXRJZiAtRm9yY2UgLVJlY3Vyc2UNCn0NCg0KJGRpciA9IEdldC1DaGlsZEl0ZW0gJy5caG9uX3NlcnZlcl8qJyB8ID8geyRfLlBTSXNDb250YWluZXJ9DQoNCiRjb25maXJtYXRpb24gPSBSZWFkLUhvc3QgIkRvIHlvdSB3YW50IHRvIGNsZWFuIGZpbGVzIG9yIHZpZXcgd2hhdCB3b3VsZCBiZSBkZWxldGVkIGZpcnN0PyAoZGVsZXRlL3ZpZXcpIg0KaWYgKCRjb25maXJtYXRpb24gLWVxICd2aWV3Jykgew0KICAgIHdyaXRlLWhvc3QoIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IikNCiAgICB3cml0ZS1ob3N0KCJ2aWV3aW5nIGZpbGVzIG9sZGVyIHRoYW4gJGxpbWl0IikNCiAgICAkZGlyIHwgRm9yRWFjaC1PYmplY3Qge1NldC1Mb2NhdGlvbiAkXy5GdWxsTmFtZTtSZW1vdmUtTG9ncy1WaWV3fQ0KICAgIHdyaXRlLWhvc3QoIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IikNCn0NCmVsc2VpZiAoJGNvbmZpcm1hdGlvbiAtZXEgJ2RlbGV0ZScpIHsNCiAgICB3cml0ZS1ob3N0KCI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIpDQogICAgd3JpdGUtaG9zdCgiZGVsZXRpbmcgZmlsZXMgb2xkZXIgdGhhbiAkbGltaXQiKQ0KICAgICRkaXIgfCBGb3JFYWNoLU9iamVjdCB7U2V0LUxvY2F0aW9uICRfLkZ1bGxOYW1lO1JlbW92ZS1Mb2dzfQ0KICAgIHdyaXRlLWhvc3QoIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IikNCn0gZWxzZSB7DQogICAgd3JpdGUtaG9zdCgiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0iKQ0KICAgIHdyaXRlLWhvc3QoIk5vdCBhIHZhbGlkIGlucHV0LiBQbGVhc2UgdHJ5IGFnYWluLiIpDQogICAgd3JpdGUtaG9zdCgiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0iKQ0KfQ0KUmVhZC1Ib3N0KCJQcmVzcyBhbnkga2V5IHRvIGNvbnRpbnVlIik= > tmp.txt
certutil -f -decode tmp.txt logrotate-hon.ps1
del tmp.txt
powershell.exe -ExecutionPolicy Bypass -File logrotate-hon.ps1